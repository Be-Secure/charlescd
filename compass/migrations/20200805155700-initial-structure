CREATE TABLE IF NOT EXISTS METRICS_GROUP (
	ID VARCHAR(36) PRIMARY KEY,
	NAME VARCHAR(100) NOT NULL
);

CREATE TABLE IF NOT exists METRICS (
	ID VARCHAR(36) PRIMARY KEY,
	NAME VARCHAR(100) NOT NULL,
	THRESHOLD REAL not null,
	CONDITION VARCHAR(30) not null,
	metric_group_id varchar(36),
	CONSTRAINT fk_metric_group_metric FOREIGN KEY(metric_group_id) REFERENCES METRICS_GROUP(id)
);

CREATE TABLE IF NOT EXISTS METRIC_FILTERS (
	ID VARCHAR(36) PRIMARY KEY,
	FIELD VARCHAR(100) NOT NULL,
	OPERATOR VARCHAR(30) not null,
	METRIC_ID varchar(36),
	CONSTRAINT fk_metric_metric_filter FOREIGN KEY(metric_id) REFERENCES METRICS(id)
);

CREATE TABLE IF NOT EXISTS METRIC_GROUPS_BY (
	ID VARCHAR(36) PRIMARY KEY,
	FIELD VARCHAR(100) NOT NULL,
	METRIC_ID varchar(36),
	CONSTRAINT fk_metric_metric_group_by FOREIGN KEY(metric_id) REFERENCES METRICS(id)
);

CREATE TABLE IF NOT EXISTS DATASOURCES (
	ID VARCHAR(36) PRIMARY KEY,
	PLUGIN_ID VARCHAR(50) NOT NULL,
	NAME VARCHAR(100) not null,
	DATA JSONB not NULL
);
