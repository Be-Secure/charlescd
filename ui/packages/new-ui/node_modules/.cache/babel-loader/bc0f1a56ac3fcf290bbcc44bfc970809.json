{"ast":null,"code":"import _slicedToArray from\"/Users/ricardobasilio/projects/charlescd/ui/packages/new-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useRef,useState,useCallback}from'react';import{buildHeaders}from'core/providers/base';function loadWorker(workerFile){var code=workerFile.toString();var blob=new Blob(['('+code+')()']);return new Worker(URL.createObjectURL(blob));}var useWorker=function useWorker(workerFile,initialValue){var worker=useRef();var _useState=useState(initialValue),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var terminateWorker=function terminateWorker(){worker.current.terminate();};var workerHook=useCallback(function(apiParams){if(worker.current){terminateWorker();}worker.current=loadWorker(workerFile);worker.current.postMessage({apiParams:apiParams,headers:buildHeaders()});worker.current.addEventListener('message',function(event){setData(event.data);});},[workerFile]);useEffect(function(){return function(){return terminateWorker();};},[]);return[data,workerHook];};export default useWorker;","map":{"version":3,"sources":["/Users/ricardobasilio/projects/charlescd/ui/packages/new-ui/src/containers/Metrics/useWorker.ts"],"names":["useEffect","useRef","useState","useCallback","buildHeaders","loadWorker","workerFile","code","toString","blob","Blob","Worker","URL","createObjectURL","useWorker","initialValue","worker","data","setData","terminateWorker","current","terminate","workerHook","apiParams","postMessage","headers","addEventListener","event"],"mappings":"kLAAA,OAASA,SAAT,CAAoBC,MAApB,CAA4BC,QAA5B,CAAsCC,WAAtC,KAAyD,OAAzD,CACA,OAASC,YAAT,KAA6B,qBAA7B,CAEA,QAASC,CAAAA,UAAT,CAAoBC,UAApB,CAA0C,CACxC,GAAMC,CAAAA,IAAI,CAAGD,UAAU,CAACE,QAAX,EAAb,CACA,GAAMC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,CAAS,CAAC,IAAMH,IAAN,CAAa,KAAd,CAAT,CAAb,CACA,MAAO,IAAII,CAAAA,MAAJ,CAAWC,GAAG,CAACC,eAAJ,CAAoBJ,IAApB,CAAX,CAAP,CACD,CAED,GAAMK,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAIR,UAAJ,CAA0BS,YAA1B,CAA6D,CAC7E,GAAMC,CAAAA,MAAM,CAAGf,MAAM,EAArB,CAD6E,cAErDC,QAAQ,CAAIa,YAAJ,CAF6C,wCAEtEE,IAFsE,eAEhEC,OAFgE,eAI7E,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CAC5BH,MAAM,CAACI,OAAP,CAAeC,SAAf,GACD,CAFD,CAGA,GAAMC,CAAAA,UAAU,CAAGnB,WAAW,CAC5B,SAACoB,SAAD,CAAuB,CACrB,GAAIP,MAAM,CAACI,OAAX,CAAoB,CAClBD,eAAe,GAChB,CAEDH,MAAM,CAACI,OAAP,CAAiBf,UAAU,CAACC,UAAD,CAA3B,CACAU,MAAM,CAACI,OAAP,CAAeI,WAAf,CAA2B,CAAED,SAAS,CAATA,SAAF,CAAaE,OAAO,CAAErB,YAAY,EAAlC,CAA3B,EACAY,MAAM,CAACI,OAAP,CAAeM,gBAAf,CAAgC,SAAhC,CAA2C,SAACC,KAAD,CAAyB,CAClET,OAAO,CAACS,KAAK,CAACV,IAAP,CAAP,CACD,CAFD,EAGD,CAX2B,CAY5B,CAACX,UAAD,CAZ4B,CAA9B,CAeAN,SAAS,CAAC,UAAM,CACd,MAAO,kBAAMmB,CAAAA,eAAe,EAArB,EAAP,CACD,CAFQ,CAEN,EAFM,CAAT,CAIA,MAAO,CAACF,IAAD,CAAOK,UAAP,CAAP,CACD,CA3BD,CA6BA,cAAeR,CAAAA,SAAf","sourcesContent":["import { useEffect, useRef, useState, useCallback } from 'react';\nimport { buildHeaders } from 'core/providers/base';\n\nfunction loadWorker(workerFile: Function) {\n  const code = workerFile.toString();\n  const blob = new Blob(['(' + code + ')()']);\n  return new Worker(URL.createObjectURL(blob));\n}\n\nconst useWorker = <T>(workerFile: Function, initialValue: T): [T, Function] => {\n  const worker = useRef<Worker>();\n  const [data, setData] = useState<T>(initialValue);\n\n  const terminateWorker = () => {\n    worker.current.terminate();\n  };\n  const workerHook = useCallback(\n    (apiParams: object) => {\n      if (worker.current) {\n        terminateWorker();\n      }\n\n      worker.current = loadWorker(workerFile);\n      worker.current.postMessage({ apiParams, headers: buildHeaders() });\n      worker.current.addEventListener('message', (event: MessageEvent) => {\n        setData(event.data);\n      });\n    },\n    [workerFile]\n  );\n\n  useEffect(() => {\n    return () => terminateWorker();\n  }, []);\n\n  return [data, workerHook];\n};\n\nexport default useWorker;\n"]},"metadata":{},"sourceType":"module"}